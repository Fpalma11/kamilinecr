(function(h){var k=window.AmazonUIPageJS||window.P,n=k._namespace||k.attributeErrors,c=n?n("PuffAuiAssets",""):k;c.guardFatal?c.guardFatal(h)(c,window):c.execute(function(){h(c,window)})})(function(h,k,n){h.when("A","PuffOrchestrator","PuffTrackingUtils","afterLoad").execute("PuffEntryPoint",function(c,a,g){g.startTimer(g.TOTAL_TIME_TIMER_NAME);a.orchestrate()});"use strict";h.when("A","PuffServiceHelper","PuffServiceResponseHandler","PuffSuppressionManager","PuffTrackingUtils","ready").register("PuffOrchestrator",
function(c,a,g,f,b){return{orchestrate:function(){try{f.isCurrentlySuppressed()?(b.recordTotalTime("ActiveSuppression"),b.recordTotalTime()):a.callGetContent().done(function(a,e,m){g.handleGetContentSuccess(a,e,m);b.recordTotalTime("Success")}).fail(function(a,e,m){g.handleGetContentError(a,e,m);b.recordTotalTime("Failed")}).always(function(){return b.recordTotalTime()})}catch(d){b.logError("Uncaught error during Puff orchestration. Due to: "+d.message),b.recordTotalTime("Failed"),b.recordTotalTime()}}}});
"use strict";h.when("A","PuffTrackingUtils","PuffRequestAttributeUtils","ready").register("PuffServiceHelper",function(c,a,g){var f=function(){var a=g.getPageTypeValues();return{pageType:a.pageType,subPageType:a.subPageType,referrer:document.referrer,hostName:k.location.host,path:k.location.pathname,queryString:k.location.search}};return{callGetContent:function(){a.startTimer("GetContentTimer");return c.$.ajax("/puff/content",{data:{data:JSON.stringify(f())}}).done(function(b,d,e){a.recordTimer("GetContentTimer",
"GetContentTime:Success");a.recordTimer("GetContentTimer","GetContentTime:Status:"+e.status)}).fail(function(b,d,e){a.recordTimer("GetContentTimer","GetContentTime:Fail");a.recordTimer("GetContentTimer","GetContentTime:Status:"+b.status)}).always(function(){a.recordTimer("GetContentTimer","GetContentTime")})},callRecordImpression:function(b,d,e,m){d={periodicDisplayIdentifier:d,campaignIdentifier:e,placementIdentifier:m};d=c.$.extend({},f(),d);a.startTimer("RecordImpressionTimer");return c.$.ajax("/puff/impression",
{type:"POST",contentType:"application/json",headers:{"anti-csrftoken-a2z":b},data:JSON.stringify(d)}).done(function(e,b,t){a.recordTimer("RecordImpressionTimer","RecordImpressionTime:Success");a.recordTimer("RecordImpressionTimer","RecordImpressionTime:Status:"+t.status)}).fail(function(e,b,t){a.recordTimer("RecordImpressionTimer","RecordImpressionTime:Fail");a.recordTimer("RecordImpressionTimer","RecordImpressionTime:Status:"+e.status)}).always(function(){a.recordTimer("RecordImpressionTimer","RecordImpressionTime")})},
callOptOut:function(b,d,e,m){d={periodicDisplayIdentifier:d,campaignIdentifier:e,placementIdentifier:m};d=c.$.extend({},f(),d);return c.$.ajax("/puff/opt-out",{type:"POST",contentType:"application/json",headers:{"anti-csrftoken-a2z":b},data:JSON.stringify(d)}).done(function(e,b,t){a.recordTimer("OptOutTimer","OptOutTime:Success");a.recordTimer("OptOutTimer","OptOutTime:Status:"+t.status)}).fail(function(e,b,t){a.recordTimer("OptOutTimer","OptOutTime:Fail");a.recordTimer("OptOutTimer","OptOutTime:Status:"+
e.status)}).always(function(){a.recordTimer("OptOutTimer","OptOutTime")})}}});"use strict";h.when("A","PuffTrackingUtils","PuffRequestAttributeUtils","ready").register("PuffSuppressionManager",function(c,a,g){var f=function(){return JSON.parse(localStorage.getItem("puff:suppression")||"{}")};return{isCurrentlySuppressed:function(){return a.runWithTimer(function(){try{var b,d=g.getSessionId();b=d?f()[d]:n;return Date.parse(b&&b.suppressUntil)>Date.now()}catch(e){return a.emitMetric("SuppressionCheckThrew"),
a.logError("Couldn't check suppression status. Defaulting to not suppressed. Message: "+e.message),!1}},"CheckIsSuppressedTime")},saveSuppression:function(b){return a.runWithTimer(function(){try{var d;var e=g.getSessionId();if(e)if(b.suppressUntil&&Date.parse(b.suppressUntil)){var m=f();m[e]=b;localStorage.setItem("puff:suppression",JSON.stringify(m));d=!0}else a.logError("Suppression not valid. Got: "+JSON.stringify(b)),d=!1;else a.logError("Can't save suppression. No sessionId available."),d=!1;
return d}catch(c){return a.emitMetric("SuppressionSaveThrew"),a.logError("Failed to save suppression. "+c.message),!1}},"SaveSuppressionTime")}}});"use strict";h.when("A","PuffSuppressionManager","PuffRenderingHandler","PuffTrackingUtils","PuffServiceHelper","ready").register("PuffServiceResponseHandler",function(c,a,g,f,b){var d=function(){return c.$(".nav-input")&&c.$(".nav-input").is(":focus")?(f.recordTotalTime("SearchActive"),!0):!1};return{handleGetContentSuccess:function(e,m,l){if(e&&204!==
l.status)switch(f.recordTotalTime(e.responseType),e.responseType){case "SUPPRESSION":a.saveSuppression(e.suppression);f.recordTotalTime("Suppressed");break;case "IMPRESSIONABLE_NO_RENDER":d()||(b.callRecordImpression(e.csrfToken,e.periodicDisplayIdentifier,e.campaignIdentifier,e.placementIdentifier),e.suppression&&(f.recordTotalTime("SuppressedAfterImpression"),a.saveSuppression(e.suppression)),f.recordTotalTime("ImpressionableNoRender"));break;case "RENDERED_FALLBACK":case "RENDERED_PRIMARY":if(!d()){try{c.$("body").append(e.content),
c.state.parse(),g.handle(e)}catch(B){throw f.emitMetric("DisplayFailed"),Error("Problem adding content to body or rendering. "+B.message);}f.recordTotalTime("Rendered")}break;default:f.logWarning("Got an unexpected responseType: "+e.responseType),f.recordTotalTime("UnsupportedResponseType")}else f.recordTotalTime("NoRender")},handleGetContentError:function(a,b,d){d="";try{d=JSON.parse(a.responseText).message}catch(c){d="Couldn't parse responseText. Got: "+(a.responseText&&a.responseText.substring(0,
200))}f.logError("Error calling puff service getContent. Status: "+a.status+". TextStatus: "+b+". Message: "+d)}}});"use strict";h.when("A","a-popover","PuffTrackingUtils","ready").register("PuffPopoverRenderer",function(c,a,g){var f=function(a,e){var f="a:popover:afterHide:"+a.contentId,g=m(e),p=g,h=g.parent().css("position");h&&"static"!==h.toLowerCase()||g.parent().css("position","relative");var g=l(g),q=function(){g.css({top:p.position().top,left:p.position().left})};c.$(k).bind("resize",q);d(f,
g,p,h,q);return b(a,g,f,e)},b=function(b,d,m,c){var f=e(b).detach(),g=c.customCssClass,f={name:b.contentId,inlineContent:f.addClass("show")[0].outerHTML,header:b.header,hideHeader:b.hideHeader,width:c.width,position:c.position},l=a.create(d,f),k=c.popoverOptions&&c.popoverOptions.removeHoverAwayDismissal;k&&l.lock();l.show();g&&l.$popover.addClass(g);return{dismissXEventName:"a:popover:dismiss:"+b.contentId,afterHideEventName:m,hideFunction:function(){k&&l.unlock();l.hide()},displayedPuffContentSelector:l.getContent()}},
d=function(b,d,e,m,f){c.on(b,function(b){a.remove(d);d.remove();c.$(k).unbind("resize",f);e.parent().css("position",m)})},e=function(a){var b=c.$("#"+a.contentId);if(!b.length)throw g.emitMetric("PopoverRenderer:NoHiddenContent"),Error("No content for popover found at id: "+a.contentId);return b},m=function(a){var b=c.$(a.trigger);if(!b.length)throw g.emitMetric("PopoverRenderer:NoAnchorContent"),Error("No content to anchor popover to at: "+a.trigger);return b},l=function(a){var b=c.$("\x3cspan/\x3e").css({display:"block",
width:a.outerWidth(!0),height:a.outerHeight(!0),position:"absolute",top:a.position().top,left:a.position().left});b.insertAfter(a);return b};return{render:function(a,b){return g.runWithTimer(function(){return f(a,b)},"DisplayPopoverTime")}}});"use strict";h.when("A","PuffPopoverRenderer","PuffDismissHandler","PuffOptOutHandler","PuffServiceHelper","PuffSuppressionManager","PuffTrackingUtils","PuffCtaHandler","ready").register("PuffRenderingHandler",function(c,a,g,f,b,d,e,m){var l=["contentId","showHeader"],
k=function(){var a=c.state("paladin-dynamic-content-state");if(!a)throw e.emitMetric("NoDynamicState"),Error("No paladin-dynamic-content-state page state found.");l.forEach(function(b){if(!a[b])throw e.emitMetric("MissingDynamicStateKey"),Error("Puff dynamic state does not have value for: "+b);});return a};return{handle:function(c){var l;l=k();var h=c.type;switch(h){case "popover":l=a.render(l,c);break;default:throw Error("Invalid puff content type: "+h);}e.recordTotalTime("Displayed");e.emitEvent("smi_puff_impression",
c.periodicDisplayIdentifier+":"+c.campaignIdentifier+":"+c.placementIdentifier);b.callRecordImpression(c.csrfToken,c.periodicDisplayIdentifier,c.campaignIdentifier,c.placementIdentifier);c.suppression&&(e.recordTotalTime("SuppressedAfterImpression"),d.saveSuppression(c.suppression));var h=l.afterHideEventName,p=l.displayedPuffContentSelector;g.init(p,l.dismissXEventName,h,l.hideFunction,c);f.init(c,p,h);m.init(p,h,c)}}});"use strict";h.when("A","PuffServiceHelper","PuffTrackingUtils","ready").register("PuffOptOutHandler",
function(c,a,g){var f=void 0,b=void 0,d=void 0,e=void 0,m=!1,l=function(){m||(a.callOptOut(d.csrfToken,d.periodicDisplayIdentifier,d.campaignIdentifier,d.placementIdentifier),g.emitEvent("smi_puff_optOut",d.periodicDisplayIdentifier+":"+d.campaignIdentifier+":"+d.placementIdentifier),g.recordTimer("DisplayTimeUntilOptOut"),f.undelegate("a","click",h),c.off(e,k),m=!0)},h=function(a){c.$(a.currentTarget).hasClass("opt-out")&&l()},k=function(){0<b.find("input:checked").length&&l()};return{init:function(a,
m,l){g.startTimer("DisplayTimeUntilOptOut");f=m;e=l;b=f.find(".opt-out");d=a;f.delegate("a","click",h);c.on(l,k)}}});"use strict";h.when("A","PuffTrackingUtils","ready").register("PuffDismissHandler",function(c,a){var g=!1,f="dismiss_bkgrnd",b="Dismiss:Background",d=!1,e=!1,m=!1,l=void 0,h=void 0,k=void 0,n=void 0,r=void 0,p=void 0,v=void 0,q=function(a,c){d||(f=a,b=c,d=!0)},w=function(){q("dismiss_btn","Dismiss:Button")},x=function(){q("dismiss_x","Dismiss:X")},y=function(){m||(a.emitEvent("smi_puff_"+
f,p.periodicDisplayIdentifier+":"+p.campaignIdentifier+":"+p.placementIdentifier),a.recordTimer("DisplayTime"),a.emitMetric(b),m=!0);g||(k.unbind("click",w),c.off(h,x),c.off(l,y),r.undelegate("a","click",z),g=!0)},u=function(){e||g||(n(),e=!0)},C=function(){p.popoverOptions&&p.popoverOptions.removeHoverAwayDismissal&&c.$("#nav-search").click(function(){q("dismiss_navSearch","Dismiss:NavSearch");u()})},A=function(a){v=c.delay(function(){q("dismiss_auto","Dismiss:Auto");u()},a)},D=function(){r.mouseenter(function(){clearTimeout(v)});
r.mouseleave(function(){A(p.popoverOptions&&p.popoverOptions.displayTimeout||7E3)})},z=function(a){c.$(a.currentTarget).hasClass("opt-out")&&(q("dismiss_optOut","Dismiss:OptOut"),u())};return{init:function(b,d,e,m,f){a.startTimer("DisplayTime");l=e;h=d;n=m;r=b;p=f;k=r.find(".dismiss");C();A(p.popoverOptions&&p.popoverOptions.displayTimeout||7E3);D();k.click(w);c.on(h,x);c.on(l,y);r.delegate("a","click",z)}}});"use strict";h.when("A","ready").register("PuffTrackingUtils",function(c){var a={},g=function(b){a[b]=
Date.now()},f=function(b){return a[b]&&Date.now()-a[b]},b=function(a,b){var c=-1!==a.indexOf(b,a.length-b.length);return a+(c?"":b)},d=function(a){var c=1<arguments.length&&arguments[1]!==n?arguments[1]:a,c=b(c,":ms"),d=f(a);d!==n&&e(c,d);return d},e=function(a){var c=1<arguments.length&&arguments[1]!==n?arguments[1]:1;k.ue&&k.ue.count&&(a=b(a,":"),k.ue.count("Paladin:PUFF:"+a,c))};return{TOTAL_TIME_TIMER_NAME:"TotalTime",emitMetric:e,emitEvent:function(a){var b=1<arguments.length&&arguments[1]!==
n?arguments[1]:null;a&&"undefined"!==typeof k.csa&&k.csa("Events",{producerId:"ab-puff"})("log",{schemaId:"abpuff.schema.TrackingRecord.1",refTag:a,campaign:b})},startTimer:g,measureTimer:f,runWithTimer:function(a,b){var c=2<arguments.length&&arguments[2]!==n?arguments[2]:b;g(b);var e=a();d(b,c);return e},recordTimer:d,recordTotalTime:function(){return d("TotalTime","TotalTime:"+(0<arguments.length&&arguments[0]!==n?arguments[0]:"ms"))},logWarning:function(a){h.log(a,"WARN","Paladin:PuffAuiAssets")},
logError:function(a){h.log(a,"ERROR","Paladin:PuffAuiAssets")}}});"use strict";h.when("A","PuffTrackingUtils","ready").register("PuffRequestAttributeUtils",function(c,a){var g=function(){var b=k.ue_pty;return b?b:(a.emitMetric("UeptyUnavailable"),n)},f=function(){var b=k.ue_spty;return b?b:(a.emitMetric("UesptyUnavailable"),n)};return{getPageTypeValues:function(){return k.uept?k.uept.pageType?{pageType:uept.pageType,subPageType:uept.subPageType||f()}:(a.emitMetric("UeptPageTypeUnavailable"),{pageType:g()||
"Unknown",subPageType:uept.subPageType||f()}):(a.emitMetric("UeptUnavailable"),{pageType:g()||"Unknown",subPageType:f()})},getSessionId:function(){if(k.ue&&k.ue.sid)return k.ue.sid;a.emitMetric("UeSidUnavailable");var b=k.ue_sid;b||a.emitMetric("Ue_SidUnavailable");return b}}});"use strict";h.when("A","PuffTrackingUtils","ready").register("PuffCtaHandler",function(c,a){var g=!1,f=!1,b=void 0,d=void 0,e=void 0,h=function(){g||(b.unbind("click",k),c.off(e,n),g=!0)},k=function(){f||(a.emitEvent("smi_puff_cta",
d.periodicDisplayIdentifier+":"+d.campaignIdentifier+":"+d.placementIdentifier),a.recordTimer("DisplayUntilCta"),f=!0);h()},n=function(){h()};return{init:function(f,g,h){a.startTimer("DisplayUntilCta");e=g;d=h;b=f.find(".puff-cta");b.click(k);c.on(g,n)}}})});